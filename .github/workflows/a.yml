on: push

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      IMAGE_VERSION: 0.0.1-11
    steps:
      - uses: actions/checkout@v2
        with:
          repository: nju33/gitpod-workspace
      - run: echo "FROM nju33/gitpod-workspace:$IMAGE_VERSION" > .gitpod.Dockerfile
      # - id: modified-dockerfile
      #   run: |
      #     if git ls-files -m | grep .gitpod.Dockerfile; then
      #       echo '::set-output name=VALUE::true'
      #     else
      #       echo '::set-output name=VALUE::false'
      #     fi
      - run: |
          git config --local user.name github-actions[bot]
          git config --local user.email 41898282+github-actions[bot]@users.noreply.github.com

          git add .gitpod.Dockerfile
          git commit -m "chore(github-actions): bump version to $IMAGE_VERSION"
          git push origin main